(()=>{const t=t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),e=t=>`${new Intl.DateTimeFormat("en-US",{month:"long"}).format(t)} ${t.getDate()}, ${t.getFullYear()}`,n=t=>{let e="../images/default-pfp.jpeg";return t.name&&(e="/image/"+t.name),e};function o(n){fetch("api/forum/loadPosts",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(n)}).then((t=>t.json())).then((n=>{if(n.status){console.log(n);let a=document.querySelector("#loadMoreBtn");n.hasMore?(a.style.display="flex",a.addEventListener("click",o)):(a.style.display="none",a.addEventListener("click",o)),n.posts.forEach((o=>{!function(n,o,a){const{_id:c,title:d,message:m,username:u,postDate:p,uID:f,likes:h,likesCount:y,comments:g,commentsCount:v}=n;let L=document.createElement("div"),k=new Date(p);L.innerHTML=`<div id="post">\n\t\t<span class="line"></span>\n\t\t<div class="forumPost" href="/forum?id=${c}" id=${c}>\n\t\t<div class="inlineForumUser">\n\t\t\t<img class="forumPfp" src="/image/${a}"></img>\n\t\t\t<a class="forumUser" href="/profile?uid=${f}">${t(u)}</a>\n\t\t\t<p id="forumDate" class="forumUser"><i class="fa-solid fa-circle"></i> ${e(k)}</p>\n\t\t</div>\n\t\t<div class="forumTitle">\n\t\t\t<h3><a id="title" href="/forum?id=${c}">${t(d)}</a></h3>\n\t\t</div>\n\t\t\n\t\t\n\t\t<p style="white-space:pre;">${m}</p>\n\t\t<div class="forumBtns">\n\t\t\t<p id="likeCounter">${y}</p>\n\t\t\t<button id="likeBtn" class="iconBtn"><i class="fa-regular fa-heart"></i></button>\n\t\t\t<p id="commentCounter">${v}</p>\n\t\t\t<button id="commentIcon" class="iconBtn"><i class="fa-regular fa-comment"></i></button>\n\t\t\t<button id="reportBtn" class="iconBtn"><i class="fa-regular fa-flag"></i></button>\n\t\t</div>\n\t\t</div>\n\t\t</div>\n\t\t`,function(t,e){let n=new FormData;n.append("userID",t),fetch("api/profile/getPfp",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(n)}).then((t=>t.json())).then((async t=>{t.status?e.querySelector(".forumPfp").src="/image/"+t.pfp:e.querySelector(".forumPfp").src="../images/default-pfp.jpeg"}))}(f,L),h.includes(o)&&(L.querySelector("#likeBtn").querySelector("i").outerHTML='<i class="fa-solid fa-heart"></i>');if(o==f){let t=document.createElement("button");t.id="deleteBtn",t.className="iconBtn",t.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.addEventListener("click",s),L.querySelector(".forumBtns").appendChild(t)}L.querySelector("#commentIcon").addEventListener("click",l),L.querySelector("#likeBtn").addEventListener("click",i),L.querySelector("#reportBtn").addEventListener("click",r),document.querySelector("#posts").appendChild(L)}(o,n.currentUserID,n.pfp)}))}else console.log(n)})).catch((t=>{console.log(t)}))}function l(){let e=event.target.closest(".forumPost").id;location.href=`forum?id=${t(e)}#commentSection`}function i(){let t=event.target;"I"!=t.nodeName&&(t=t.querySelector("i"));const e=t.closest("#post"),n=e.querySelector("#likeBtn"),o=(e.querySelector("#title"),t.closest(".forumPost").id),l=e.querySelector("#likeCounter"),i=new FormData;i.append("postID",o);try{'<i class="fa-regular fa-heart"></i>'==t.outerHTML?(t.outerHTML='<i class="fa-solid fa-heart"></i>',l.innerHTML++):(t.outerHTML='<i class="fa-regular fa-heart"></i>',l.innerHTML--),n.enabled=!1}catch(t){console.log(t)}fetch("api/forum/likePost",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(i)}).then((t=>t.json())).then((e=>{console.log(e),"like"==e.type?t.outerHTML='<i class="fa-solid fa-heart"></i>':"unlike"==e.type&&(t.outerHTML='<i class="fa-regular fa-heart"></i>'),l.innerHTML=e.likes,n.enabled=!0})).catch((t=>{console.log(t),n.enabled=!0}))}function r(){const t=event.target.closest(".forumPost"),e=t.id,n=t.querySelector(".forumUser").innerHTML;document.querySelector("#reportTitle").innerHTML=`Report <a href="/forum?id=${e}">${n}'s Post</a>`,document.querySelector("#makeReport").style.display="flex",document.querySelector("#reportInformation").style.display="flex"}function s(){let t=event.target.closest(".forumPost").id;const e=new FormData;e.append("postID",t),fetch("api/forum/delete-post",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)}).then((t=>t.json())).then((t=>{console.log(t),t.status?(console.log("success"),window.location.replace("/forum")):(t.message,console.log("error!"))})).catch((t=>{console.log(t)}))}function a(){let t=event.target.closest(".comment").id;const e=new FormData;e.append("commentID",t),fetch("api/forum/delete-comment",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)}).then((t=>t.json())).then((t=>{console.log(t),t.status?(console.log("success"),window.location.reload()):(t.message,console.log("error!"))})).catch((t=>{console.log(t)}))}function c(){let t=event.target,e=t.closest(".comment").parentElement.querySelectorAll("#reply");e.forEach((t=>t.remove()));let n=`Load ${e.length} replies`;1===e.length&&(n=`Load ${e.length} reply`),t.innerHTML=n,t.removeEventListener("click",c),t.addEventListener("click",d)}function d(){let o=event.target;o.removeEventListener("click",d);let l=o.innerHTML;o.innerHTML="Loading...";let i=o.closest(".comment").id,r=o.closest(".comment"),s=new FormData;s.append("commentID",i),fetch("api/forum/get-replies",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(s)}).then((t=>t.json())).then((i=>{if(i.status){o.innerHTML="Hide Replies",o.removeEventListener("click",d),o.addEventListener("click",c);let l=i.replies,s=i.uid;console.log(l),l.forEach((o=>{let l=o.reply,i=o.pfp,c=n(i);const{_id:m,author:u,authorID:p,content:f,postDate:h,comments:y,likes:g,likesCount:v,commentsCount:L}=l;let k=new Date(h),B=document.createElement("div");if(B.id="reply",B.style.marginLeft="5%",B.innerHTML=`\n\t\t\t\t\t<div>\n\t\t\t\t\t<span class="line"></span>\n\t\t\t\t\t<div style="padding: 10px; border-radius: 10px;" class="comment" id=${m}>\n\t\t\t\t\t\t<div class="inlineForumUser">\n\t\t\t\t\t\t<img id="postPfp" class="forumPfp" src="${c}"></img>\n\t\t\t\t\t\t<a class="forumUser" href="/profile?uid=${p}">${t(u)}</a>\n\t\t\t\t\t\t<p id="forumDate" class="forumUser"><i class="fa-solid fa-circle"></i> ${e(k)}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<p style="white-space:pre; font-family: 'roboto'; font-size: 19px;">${t(f)}</p>\n\t\t\t\t\t\t<div class="forumBtns">\n\t\t\t\t\t\t\t<p id="likeCounter">${v}</p>\n\t\t\t\t\t\t\t<button id="likeBtn" class="iconBtn"><i class="fa-regular fa-heart"></i></button>\n\t\t\t\t\t\t\t<button id="reportBtn" class="iconBtn"><i class="fa-regular fa-flag"></i></button>\n\t\t\t\t\t\t\t<button id="replyBtn" class="iconBtn">Reply</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`,B.querySelector("#likeBtn").addEventListener("click",likeComment),B.querySelector("#replyBtn").addEventListener("click",replyClick),B.querySelector("#reportBtn").addEventListener("click",reportComment),g.includes(s)&&(B.querySelector("#likeBtn").querySelector("i").outerHTML='<i class="fa-solid fa-heart"></i>'),s==p){let t=document.createElement("button");t.id="deleteBtn",t.className="iconBtn",t.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.addEventListener("click",a),B.querySelector(".forumBtns").appendChild(t)}if(y.length>0){let t=document.createElement("div"),e=`Load ${L} replies`;1===y.length&&(e=`Load ${L} reply`),t.innerHTML=`<button style="text-indent: 0px; padding: 10px;"class="faqBtn" id="openReplyBtn">${e}</button>`,t.querySelector("#openReplyBtn").addEventListener("click",d),B.querySelector(".comment").appendChild(t)}r.insertAdjacentElement("afterend",B)}))}else o.innerHTML=l,o.onclick=d})).catch((t=>{console.log(t),o.innerHTML=l,o.onclick=d}))}!function(){const l=function(){let t=window.location.search.split("?")[1];return t?t.split("&")[0].split("=")[1]:null}();let c=0;c=document.querySelectorAll("#post").length;const m=new FormData;m.append("type","devotion"),m.append("loadedPosts",c),l?function(o){const l=new FormData;l.append("id",o),fetch("api/forum/loadPost",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(l)}).then((t=>t.json())).then((o=>{console.log(o),o.status?function(o,l,c){const{_id:m,title:u,message:p,username:f,postDate:h,uID:y,likes:g,likesCount:v,comments:L,commentsCount:k}=o;let B=document.createElement("div"),S=new Date(h),w="../images/default-pfp.jpeg";c&&(w=`/image/${c.name}`);document.querySelector(".backBtn").style.display="flex",document.querySelector("#sorting").style.display="none",B.innerHTML=`<div id="post">\n\t\t<span class="line"></span>\n\t\t<div class="forumPost" id=${m}>\n\t\t<div class="inlineForumUser">\n\t\t\t<img id="postPfp" class="forumPfp" src="${w}"></img>\n\t\t\t<a class="forumUser" href="/profile?uid=${y}">${t(f)}</a>\n\t\t\t<p id="forumDate" class="forumUser"><i class="fa-solid fa-circle"></i> ${e(S)}</p>\n\t\t</div>\n\t\t\n\t\t<div class="forumTitle">\n\t\t\t<h3><a id="title">${t(u)}</a></h3>\n\t\t</div>\n\t\t\n\t\t\n\t\t<p style="white-space:pre;">${p}</p>\n\t\t<div class="forumBtns">\n\t\t\t<p id="likeCounter">${v}</p>\n\t\t\t<button id="likeBtn" class="iconBtn"><i class="fa-regular fa-heart"></i></button>\n\t\t\t<p id="commentCounter">${k}</p>\n\t\t\t<button id="commentIcon" class="iconBtn"><i class="fa-regular fa-comment"></i></button>\n\t\t\t<button id="reportBtn" class="iconBtn"><i class="fa-regular fa-flag"></i></button>\n\t\t</div>\n\t\t</div>\n\t\t<div id="commentSection" class="commentSection">\n\t\t\t<h2 class="forumTitle">Comments</h2>\n\t\t\t<textarea class="postText" id="comment" placeholder="Add a comment..." type="text"></textarea>\n\t\t\t<button style="line-height: 0px;"id="commentBtn" class="btnLink">Comment</button>\n\t\t\t<div id="commentsList" class="commentsList">\n\t\t\t</div>\n\t\t</div>\n\t\t</div>\n\t\t</div>\n\t\t`,g.includes(l)&&(B.querySelector("#likeBtn").querySelector("i").outerHTML='<i class="fa-solid fa-heart"></i>');if(l==y){let t=document.createElement("button");t.id="deleteBtn",t.className="iconBtn",t.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.addEventListener("click",s),B.querySelector(".forumBtns").appendChild(t)}B.querySelector("#reportBtn").addEventListener("click",r),B.querySelector("#commentIcon").addEventListener("click",goToCommentSection),B.querySelector("#likeBtn").addEventListener("click",i),B.querySelector("#commentBtn").addEventListener("click",comment),document.querySelector("#posts").appendChild(B),L.forEach((o=>{!function(o,l){const i=new FormData;i.append("commentID",o),fetch("api/forum/loadComment",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(i)}).then((t=>t.json())).then((o=>{console.log(o);const i=o.comment,{_id:r,author:s,authorID:c,content:m,postDate:u,comments:p,likes:f,likesCount:h,commentsCount:y}=i;console.log("Replies:",p);let g=new Date(u),v=document.createElement("div");console.log(o.pfp);let L=n(o.pfp);if(v.innerHTML=`\n\t\t\t<div>\n\t\t\t<span class="line"></span>\n\t\t\t<div style="padding: 10px; border-radius: 10px;" class="comment" id=${r}>\n\t\t\t\t<div class="inlineForumUser">\n\t\t\t\t<img id="postPfp" class="forumPfp" src="${L}"></img>\n\t\t\t\t<a class="forumUser" href="/profile?uid=${c}">${t(s)}</a>\n\t\t\t\t<p id="forumDate" class="forumUser"><i class="fa-solid fa-circle"></i> ${e(g)}</p>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<p style="font-family: 'roboto'; font-size: 19px;">${t(m)}</p>\n\t\t\t\t<div class="forumBtns">\n\t\t\t\t\t<p id="likeCounter">${h}</p>\n\t\t\t\t\t<button id="likeBtn" class="iconBtn"><i class="fa-regular fa-heart"></i></button>\n\t\t\t\t\t<button id="reportBtn" class="iconBtn"><i class="fa-regular fa-flag"></i></button>\n\t\t\t\t\t<button id="replyBtn" class="iconBtn">Reply</button>\n\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`,v.querySelector("#likeBtn").addEventListener("click",likeComment),v.querySelector("#replyBtn").addEventListener("click",replyClick),v.querySelector("#reportBtn").addEventListener("click",reportComment),f.includes(l)&&(v.querySelector("#likeBtn").querySelector("i").outerHTML='<i class="fa-solid fa-heart"></i>'),l==c){let t=document.createElement("button");t.id="deleteBtn",t.className="iconBtn",t.innerHTML='<i class="fa-regular fa-trash-can"></i>',t.addEventListener("click",a),v.querySelector(".forumBtns").appendChild(t)}if(document.querySelector("#commentsList").appendChild(v),window.location.hash&&"commentSection"==window.location.hash.substring(1)&&goToCommentSection(),p.length>0){let t=document.createElement("div"),e=`Load ${y} replies`;1===p.length&&(e=`Load ${y} reply`),t.innerHTML=`<button style="text-indent: 0px; padding: 10px;"class="faqBtn" id="openReplyBtn">${e}</button>`,t.querySelector("#openReplyBtn").addEventListener("click",d),v.querySelector(".comment").appendChild(t)}})).catch((t=>{console.log(t)}))}(o,l)}))}(o.post,o.currentUserID,o.pfp):console.log("error!")})).catch((t=>{console.log(t)}))}(l):o(m)}()})();