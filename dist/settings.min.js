(()=>{const e=["5cc9c4dade2a2","5cc9c50d875e5","5cc9c54839744","5cc9c565839f9","5cc9c5b9deeca","5cc9c5c85507e"],n=e=>`${new Intl.DateTimeFormat("en-US",{month:"long"}).format(e)} ${e.getDate()}, ${e.getFullYear()}`,t=(e,n)=>{const t=document.querySelector("#"+e);o(t,n)},o=(e,n)=>{e.style.border=`2px solid ${n}`},r=(e,n,t)=>{try{document.querySelector(`#${e}Error`).innerHTML=n}catch(o){document.querySelector(`#${e}`).insertAdjacentHTML("afterend",`<p style="color: ${t}; margin-bottom: 0px; font-size: 13pt;" id="${e}Error">${n}</p>`)}},c=e=>{try{document.querySelector(`#${e}Error`).remove()}catch(e){}};function u(){let e=document.querySelector("#confirmPopupBtn");e.innerHTML="Processing...",e.onclick=null,fetch("api/checkout/cancel-subscription",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((async o=>{console.log(o),o.status?(e.onclick=u,e.innerHTML="Cancelled",document.querySelector("#popupBlur").addEventListener("click",(()=>{location.reload()})),t("confirmPopupBtn","green"),c("confirmPopupBtn"),r("confirmPopupBtn",`Your subscription has been cancelled.<br>You will still have access to LXR until ${n(new Date(1e3*o.subscription.current_period_end))}`,"green")):(t("confirmPopupBtn","red"),c("confirmPopupBtn"),r("confirmPopupBtn","An error occurred while processing your cancellation request. Please try again.","red"),e.onclick=u,e.innerHTML="Confirm")})).catch((e=>{}))}function i(){const e=document.querySelector("#imageUpload").files[0];try{!function(e){var n=new FileReader;n.onload=function(e){var n=new Image;n.src=e.target.result,n.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),o=n.width,r=n.height;return o>r?o>128&&(r*=128/o,o=128):r>128&&(o*=128/r,r=128),e.width=o,e.height=r,t.drawImage(n,0,0,o,r),e.toBlob((function(e){console.log(e);const n=new FormData;n.append("file",e),fetch("api/profile/upload-pfp",{method:"post",body:n}).then((e=>e.json())).then((async e=>{console.log(e),location.reload()}))}),"image/jpeg",1)}},n.readAsDataURL(e)}(e)}catch(e){console.log("Error uploading image:",e)}}function a(e){try{let n=new FormData;n.append("tier",e),fetch("api/checkout/change-subscription",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(n)}).then((e=>e.json())).then((async e=>{console.log(e)})).catch((e=>{console.log(e)}))}catch(e){}}document.addEventListener("DOMContentLoaded",(()=>{document.querySelector("#imageUpload").addEventListener("change",i)})),function(){let e=(e=>{let n=null;return document.cookie.split(";").forEach((t=>{if(t.includes(`${e}=`))return n=t.split(`${e}=`)[1],n})),n})("pfp");document.querySelector("#imagePreview").src=e?`/image/${e}`:"../images/default-pfp.jpeg",fetch("api/profile/getPfp",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((async e=>{e.status?document.querySelector("#imagePreview").src=`/image/${e.pfp}`:document.querySelector("#imagePreview").src="../images/default-pfp.jpeg"})).catch((e=>{console.log(e)}))}();const l=e=>{switch(e){case"5cc9c4dade2a2":return 0;case"5cc9c50d875e5":return 1;case"5cc9c54839744":return 2;case"5cc9c565839f9":return 3;case"5cc9c5b9deeca":return 4;case"5cc9c5c85507e":return 5}};function s(){document.querySelector("#popupTitle").innerHTML="Are you sure you want to cancel your subscription?",document.querySelector("#popupBlur").style.display="flex",document.querySelector("#popupBox").style.display="flex",document.querySelector("#confirmPopupBtn").addEventListener("click",u)}function p(){document.querySelector("#popupTitle").innerHTML="Would you like to renew your subscription?",document.querySelector("#popupBlur").style.display="flex",document.querySelector("#popupBox").style.display="flex",document.querySelector("#confirmPopupBtn").addEventListener("click",f)}function d(){let e=event.target.closest(".subscription").dataset.tier;document.querySelector("#popupTitle").innerHTML="Are you sure you want to change your plan?",document.querySelector("#popupBlur").style.display="flex",document.querySelector("#popupBox").style.display="flex",document.querySelector("#popupBox").dataset.tier=e,document.querySelector("#confirmPopupBtn").addEventListener("click",y)}function m(){let e=event.target.closest(".subscription").dataset.tier;document.querySelector("#popupTitle").innerHTML="Are you sure you want to subscribe to this plan?",document.querySelector("#popupBlur").style.display="flex",document.querySelector("#popupBox").style.display="flex",document.querySelector("#popupBox").dataset.tier=e,document.querySelector("#confirmPopupBtn").addEventListener("click",h)}function h(){const e=document.querySelector("#popupBox").dataset.tier,n=l(e);let o=new FormData;o.append("tier",n);let u=document.querySelector("#confirmPopupBtn");u.innerHTML="Processing...",u.onclick=null,fetch("api/checkout/create-checkout-session",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(o)}).then((e=>e.json())).then((async e=>{console.log(e),e.status?(c("confirmPopupBtn"),t("confirmPopupBtn","green"),window.location=e.url):(console.log("Error while creating Stripe checkout session."),t("confirmPopupBtn","red"),c("confirmPopupBtn"),r("confirmPopupBtn","Error while creating your checkout session. Please try again.","red"),u.innerHTML="Confirm")})).catch((e=>{console.log(e)}))}function y(){const e=document.querySelector("#popupBox").dataset.tier;let o=new FormData;o.append("priceID",e);let u=document.querySelector("#confirmPopupBtn");u.innerHTML="Processing...",u.onclick=null,fetch("api/checkout/change-subscription",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(o)}).then((e=>e.json())).then((async e=>{console.log(e),e.status?(u.innerHTML="Changed",document.querySelector("#popupBlur").addEventListener("click",(()=>{location.reload()})),t("confirmPopupBtn","green"),c("confirmPopupBtn"),r("confirmPopupBtn",`Your subscription has been changed.<br>You will still be charged on ${n(new Date(1e3*e.subscription.current_period_end))}`,"green")):(t("confirmPopupBtn","red"),c("confirmPopupBtn"),r("confirmPopupBtn","An error occurred while processing your subscription change request. Please try again.","red"),u.innerHTML="Confirm"),u.onclick=y})).catch((e=>{}))}function f(){let e=document.querySelector("#confirmPopupBtn");e.innerHTML="Processing...",e.onclick=null,fetch("api/checkout/renew-subscription",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((async o=>{console.log(o),o.status?(e.onclick=f,e.innerHTML="Renewed",document.querySelector("#popupBlur").addEventListener("click",(()=>{location.reload()})),t("confirmPopupBtn","green"),c("confirmPopupBtn"),r("confirmPopupBtn",`Your subscription has been renewed.<br>You will still be charged on ${n(new Date(1e3*o.subscription.current_period_end))}`,"green")):(t("confirmPopupBtn","red"),c("confirmPopupBtn"),r("confirmPopupBtn","An error occurred while processing your cancellation request. Please try again.","red"),e.onclick=f,e.innerHTML="Confirm")})).catch((e=>{}))}function g(){console.log("new subscriber"),function(){let e=document.querySelectorAll(".subscription");for(let n=0;n<e.length;n++){let t=document.createElement("button");t.className="subBtn",t.id="changeSubscriptionBtn",t.onclick=m,t.innerHTML='<i class="fa-solid fa-credit-card"></i> Subscribe',e[n].appendChild(t)}}()}(()=>{let n=document.querySelectorAll(".subscription");for(let t=0;t<n.length;t++)n[t].dataset.tier=e[t]})(),document.querySelector("#popupBlur").addEventListener("click",(()=>{document.querySelector("#popupBlur").style.display="none",document.querySelector("#popupBox").style.display="none"})),async function(){const e=await new Promise(((e,n)=>{setTimeout((()=>{fetch("api/checkout/get-subscription",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((async n=>{console.log(n),e(n.subscription)}))}),100)})).catch((e=>{reject(e)}));if(!e)return void g();const n=e.plan.id,t=l(n),o=e.cancel_at_period_end;!function(e){let n=document.querySelectorAll(".subscription");for(let t=0;t<n.length;t++){if(t===e)continue;let o=document.createElement("button");o.className="subBtn",o.id="changeSubscriptionBtn",o.style="position: initial; margin-bottom: 15px;",o.onclick=d,o.innerHTML='<i class="fa-solid fa-repeat"></i> Change Subscription',n[t].appendChild(o)}}(t),function(e,n){let t=document.querySelectorAll(".subscription")[e];t.style.backgroundColor="#212121",t.style.color="white",t.style.border="solid 1px #464646";let o=document.createElement("button");o.style.backgroundColor="#fff",o.style.color="#44372c",o.style="position: initial; margin-bottom: 15px;",o.className="subBtn",o.id="changeSubscriptionBtn",n?(o.onclick=p,o.innerHTML='<i class="fa-solid fa-arrow-rotate-right"></i> Renew Subscription'):(o.onclick=s,o.innerHTML='<i class="fa-solid fa-trash"></i> Cancel Subscription'),t.appendChild(o)}(t,o)}();let b,w=document.querySelectorAll(".subBtn");for(let e=0;e<w.length;e++)w[e].addEventListener("click",(()=>{a(e)}));function S(){let e=event.target.id;e||(e=event.target.parentElement.id),document.querySelectorAll(".settingSection").forEach((e=>{e.style.display="none"})),v(e)}let q=500;const B=(e,n)=>{clearTimeout(b),b=setTimeout(e,n)},L=e=>""==e?(t("usernameInput","red"),r("usernameInput","Username cannot be left empty!","red"),!1):e.length<3?(t("usernameInput","red"),r("usernameInput","Username cannot be less than 3 characters!","red"),!1):!(e.length>20)||(t("usernameInput","red"),r("usernameInput","Username cannot be more than 20 characters!","red"),!1);function P(){let e=document.querySelector("#usernameInput").value;L(e);const n=new FormData;return n.append("username",e),new Promise(((o,u)=>{setTimeout((()=>{fetch("api/auth/check-unique-username",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(n)}).then((e=>e.json())).then((n=>{console.log(n),n.status?(t("usernameInput","green"),c("usernameInput"),L(e)):(t("usernameInput","red"),r("usernameInput","Please choose a unique username!","red")),o(n.status)}))}),100)})).catch((e=>{reject(e)}))}async function T(){let e=await P();if(console.log(e),e){let e=new FormData;e.append("username",document.querySelector("#usernameInput").value),fetch("api/profile/update-username",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)}).then((e=>e.json())).then((e=>{console.log(e),e.status?(c("usernameInput"),t("usernameInput","transparent"),document.querySelector("#usernameInput").value="",document.querySelector("#usernameInput").placeholder=e.username,document.querySelector("#username").innerHTML=e.username):(console.log("Error while changing username."),c("usernameInput"),r("usernameInput","Error while changing your username.","red"),t("usernameInput","red"))}))}}function k(){let e=new FormData;e.append("bio",document.querySelector("#bioInput").value),fetch("api/profile/update-bio",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)}).then((e=>e.json())).then((e=>{console.log(e),e.status?(c("bioInput"),t("bioInput","transparent"),document.querySelector("#bioInput").value="",document.querySelector("#bioInput").placeholder=e.bio):(console.log("Error while changing biography."),c("bioInput"),r("bioInput",e.message,"red"),t("bioInput","red"))}))}function v(e){if(document.querySelector("#"+e+"Menu").style.display="flex","account"===e)document.querySelector("#usernameInput").addEventListener("input",(()=>{B(P,q)})),document.querySelector("#changeUserBtn").addEventListener("click",T),document.querySelector("#changeBioBtn").addEventListener("click",k),fetch("api/profile/load",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((e=>{if(console.log(e),e.status){let{username:n,bio:t}=e.profile;document.querySelector("#usernameInput").placeholder=n,document.querySelector("#bioInput").placeholder=t}}))}document.querySelectorAll(".settingSidebarBtn").forEach((e=>{e.addEventListener("click",S)})),v("account");const x=document.querySelector("#bioInput");let I=!1;x.addEventListener("input",(function(){x.value.length>300?(x.classList.add("maxLength"),document.querySelector("#biographyWarning").style="display: block; color: #f75252;",document.querySelector("#biographyWarning").innerHTML="Your Biography is too long...",I=!0):!0===I&&x.value.length<=300&&(document.querySelector("#biographyWarning").style="display: block; color: #3dd598;",document.querySelector("#biographyWarning").innerHTML="Your Biography is proper length",x.classList.remove("maxLength"))}))})();