(()=>{const e=(e,n)=>{const a=document.querySelector("#"+e);t(a,n)},t=(e,t)=>{e.style.border=`2px solid ${t}`},n=(e,t,n)=>{try{document.querySelector(`#${e}Error`).innerHTML=t}catch(a){document.querySelector(`#${e}`).insertAdjacentHTML("afterend",`<p style="color: ${n}; margin-bottom: 0px; font-size: 13pt;" id="${e}Error">${t}</p>`)}},a=e=>{try{document.querySelector(`#${e}Error`).remove()}catch(e){}};async function r(e){return new Promise(((t,n)=>{setTimeout((()=>{fetch("api/auth/signup",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(e)}).then((e=>e.json())).then((e=>{t(e.id)}))}),700)})).catch((e=>{reject(e)}))}const o=t=>""==t?(e("usernameInput","red"),n("usernameInput","Username cannot be left empty!","red"),!1):t.length<3?(e("usernameInput","red"),n("usernameInput","Username cannot be less than 3 characters!","red"),!1):!(t.length>20)||(e("usernameInput","red"),n("usernameInput","Username cannot be more than 20 characters!","red"),!1),u=t=>""==t?(e("email","red"),n("email","Email cannot be left empty!","red"),!1):!(t.length<4||!t.includes("@"))||(e("email","red"),n("email","Please choose a valid email!","red"),!1),c=()=>{let t=document.querySelector("#password").value;return t.length>=8&&/\d/.test(t)&&/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(t)?(e("password","green"),a("password"),!0):(e("password","red"),n("password","Password must be at least 8 characters long, have a number, and have a capital and lowercase character","red"),!1)};async function s(){let e=document.querySelector("#usernameInput").value,t=document.querySelector("#email").value;o(e)&&u(t)&&await m().then((async e=>{e&&await i().then((e=>{e&&(anime({targets:"#signup1",opacity:0,easing:"easeInOutExpo",duration:1e3}),setTimeout((function(){document.getElementById("signup1").style.display="none",document.querySelector("#signup2").style.display="flex"}),1e3))}))}))}async function d(){let t=document.querySelector("#firstName").value,a=document.querySelector("#lastName").value,o=document.querySelector("#phoneNumber").value,u=document.querySelector("#address").value;(t=>""!=t||(e("firstName","red"),n("firstName","First name cannot be left empty!","red"),!1))(t)&&(t=>""!=t||(e("lastName","red"),n("lastName","Last name cannot be left empty!","red"),!1))(a)&&(t=>""!=t||(e("phoneNumber","red"),n("phoneNumber","Phone number cannot be left empty!","red"),!1))(o)&&(t=>""!=t||(e("address","red"),n("address","Home address cannot be left empty!","red"),!1))(u)&&((()=>{document.querySelector("#signup2").style.display="none";let e=document.querySelector("#email").value;const t=new FormData;t.append("email",e),fetch("api/auth/check-unique-email",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t)}).then((e=>e.json())).then((e=>{if(e.status&&e.returningUser){let e=document.querySelector("#usernameInput").value,t=document.querySelector("#email").value,n=document.querySelector("#password").value,a=document.querySelector("#firstName").value,o=document.querySelector("#lastName").value,u=document.querySelector("#phoneNumber").value,c=document.querySelector("#address").value,s=document.querySelector("#city").value,d=document.querySelector("#zip").value,l=document.querySelector("#state").value;const m=new FormData;m.append("username",e),m.append("email",t),m.append("password",n),m.append("returningUser",!0),m.append("firstName",a),m.append("lastName",o),m.append("phoneNumber",u),m.append("address",c),m.append("city",s),m.append("zip",d),m.append("state",l),r(m).then((e=>{console.log("Account created: "+e),location.replace("/login")}))}else document.querySelector("#signup3").style.display="flex"}))})(),anime({targets:"#signup2",opacity:0,easing:"easeInOutExpo",duration:1e3}),setTimeout((function(){document.getElementById("signup2").style.display="none"}),1e3))}async function l(){let t,o=document.querySelectorAll(".subscriptionDesc");for(let e=0;e<o.length;e++)"true"===o[e].getAttribute("data-selected")&&(t=e);let u=document.querySelector("#firstName").value,c=document.querySelector("#lastName").value,s=document.querySelector("#phoneNumber").value,d=document.querySelector("#address").value,l=document.querySelector("#usernameInput").value,m=document.querySelector("#email").value,i=document.querySelector("#password").value,p=document.querySelector("#city").value,y=document.querySelector("#zip").value,h=document.querySelector("#state").value;const w=new FormData;w.append("tier",t),w.append("username",l),w.append("email",m),w.append("password",i),w.append("returningUser",!1),w.append("firstName",u),w.append("lastName",c),w.append("phoneNumber",s),w.append("address",d),w.append("city",p),w.append("zip",y),w.append("state",h),fetch("api/checkout/start",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(w)}).then((e=>e.json())).then((async o=>{o.status?r(w).then((r=>{console.log("ID: "+r),function(t,r){const o=new FormData;o.append("uid",t),o.append("tier",r);let u=document.querySelector("#checkoutBtn");u.onclick=null,u.innerHTML="Processing...",fetch("api/checkout/create-checkout-session",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(o)}).then((e=>e.json())).then((t=>{console.log(t),t.status?(a("checkoutBtn"),e("checkoutBtn","green"),window.location=t.url):(u.innerHTML="Check out",console.log("Error while creating Stripe checkout session."),a("checkoutBtn"),n("checkoutBtn","Cannot create your account. Make sure you have a valid email address.","red"),e("checkoutBtn","red"))}))}(r,t)})):console.log(o.message)}))}async function m(){let t=document.querySelector("#usernameInput").value;o(t);const r=new FormData;return r.append("username",t),new Promise(((u,c)=>{setTimeout((()=>{fetch("api/auth/check-unique-username",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(r)}).then((e=>e.json())).then((r=>{console.log(r),r.status?(e("usernameInput","green"),a("usernameInput"),o(t)):(e("usernameInput","red"),n("usernameInput","Please choose a unique username!","red")),u(r.status)}))}),100)})).catch((e=>{reject(e)}))}async function i(){let t=document.querySelector("#email").value;u(t);const r=new FormData;return r.append("email",t),new Promise(((o,c)=>{setTimeout((()=>{fetch("api/auth/check-unique-email",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(r)}).then((e=>e.json())).then((r=>{console.log(r),r.status&&!r.returningUser?(e("email","green"),a("email"),u(t)):r.status&&r.returningUser?(e("email","blue"),a("email"),n("email","This email is linked to your previous Save the Cowboy account.","blue")):(e("email","red"),a("email"),n("email","Please choose a unique email!","red")),o(r.status)}))}),100)})).catch((e=>{reject(e)}))}let p;const y=(e,t)=>{clearTimeout(p),p=setTimeout(e,t)};document.addEventListener("DOMContentLoaded",(()=>{document.querySelector("#continueBtn").addEventListener("click",s),document.querySelector("#continueAgain").addEventListener("click",d),document.querySelector("#checkoutBtn").addEventListener("click",l),document.querySelector("#usernameInput").addEventListener("input",(()=>{y(m,500)})),document.querySelector("#email").addEventListener("input",(()=>{y(i,500)})),document.querySelector("#password").addEventListener("input",(()=>{y(c,500)}))})),document.addEventListener("DOMContentLoaded",(function(){document.querySelector("#showPassword").addEventListener("change",(function(){let e=document.getElementById("showPassword"),t=document.getElementById("password");e.checked?t.setAttribute("type","text"):t.setAttribute("type","password")}))}))})();